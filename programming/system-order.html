<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>System Order of Execution</title>
        
        


        <!-- Custom HTML head -->
        <script async defer src="https://buttons.github.io/buttons.js"></script>


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="../favicon.svg">
        
        
        <link rel="shortcut icon" href="../favicon.png">
        
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        
        <link rel="stylesheet" href="../css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="../fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../introduction.html">Introduction</a></li><li class="chapter-item expanded "><a href="../cheatsheet.html"><strong aria-hidden="true">1.</strong> Bevy Cheatsheet</a></li><li class="chapter-item expanded "><a href="../programming/_index.html"><strong aria-hidden="true">2.</strong> Bevy Programming</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../programming/_basics.html"><strong aria-hidden="true">2.1.</strong> Basics</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../programming/ecs-intro.html"><strong aria-hidden="true">2.1.1.</strong> Intro to ECS</a></li><li class="chapter-item expanded "><a href="../programming/ec.html"><strong aria-hidden="true">2.1.2.</strong> Entities and Components</a></li><li class="chapter-item expanded "><a href="../programming/res.html"><strong aria-hidden="true">2.1.3.</strong> Resources</a></li><li class="chapter-item expanded "><a href="../programming/systems.html"><strong aria-hidden="true">2.1.4.</strong> Systems</a></li><li class="chapter-item expanded "><a href="../programming/queries.html"><strong aria-hidden="true">2.1.5.</strong> Queries</a></li><li class="chapter-item expanded "><a href="../programming/commands.html"><strong aria-hidden="true">2.1.6.</strong> Commands</a></li><li class="chapter-item expanded "><a href="../programming/events.html"><strong aria-hidden="true">2.1.7.</strong> Events</a></li><li class="chapter-item expanded "><a href="../programming/app-builder.html"><strong aria-hidden="true">2.1.8.</strong> App Builder (fn main)</a></li></ol></li><li class="chapter-item expanded "><a href="../programming/_next-steps.html"><strong aria-hidden="true">2.2.</strong> Next Steps</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../programming/local.html"><strong aria-hidden="true">2.2.1.</strong> Local Resources</a></li><li class="chapter-item expanded "><a href="../programming/plugins.html"><strong aria-hidden="true">2.2.2.</strong> Plugins</a></li><li class="chapter-item expanded "><a href="../programming/system-order.html" class="active"><strong aria-hidden="true">2.2.3.</strong> System Order of Execution</a></li><li class="chapter-item expanded "><a href="../programming/system-sets.html"><strong aria-hidden="true">2.2.4.</strong> System Sets</a></li><li class="chapter-item expanded "><a href="../programming/parent-child.html"><strong aria-hidden="true">2.2.5.</strong> Hierarchical Entities</a></li><li class="chapter-item expanded "><a href="../programming/change-detection.html"><strong aria-hidden="true">2.2.6.</strong> Change Detection</a></li><li class="chapter-item expanded "><a href="../programming/system-chaining.html"><strong aria-hidden="true">2.2.7.</strong> System Chaining</a></li><li class="chapter-item expanded "><a href="../programming/query-sets.html"><strong aria-hidden="true">2.2.8.</strong> Query Sets</a></li><li class="chapter-item expanded "><a href="../programming/states.html"><strong aria-hidden="true">2.2.9.</strong> States</a></li><li class="chapter-item expanded "><a href="../programming/run-criteria.html"><strong aria-hidden="true">2.2.10.</strong> Run Criteria</a></li><li class="chapter-item expanded "><a href="../programming/labels.html"><strong aria-hidden="true">2.2.11.</strong> Labels</a></li></ol></li><li class="chapter-item expanded "><a href="../programming/_advanced.html"><strong aria-hidden="true">2.3.</strong> Advanced</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../programming/stages.html"><strong aria-hidden="true">2.3.1.</strong> Stages</a></li><li class="chapter-item expanded "><a href="../programming/world-exclusive.html"><strong aria-hidden="true">2.3.2.</strong> Direct World/ECS Access</a></li><li class="chapter-item expanded "><a href="../programming/non-send.html"><strong aria-hidden="true">2.3.3.</strong> Non-Send Resources</a></li><li class="chapter-item expanded "><a href="../programming/run-criteria-loop.html"><strong aria-hidden="true">2.3.4.</strong> Looping Run Criteria</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../features/_index.html"><strong aria-hidden="true">3.</strong> Bevy Features</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../features/transforms.html"><strong aria-hidden="true">3.1.</strong> Transforms and Coordinates</a></li><li class="chapter-item expanded "><a href="../features/assets.html"><strong aria-hidden="true">3.2.</strong> Assets</a></li><li class="chapter-item expanded "><a href="../features/input-handling.html"><strong aria-hidden="true">3.3.</strong> Input Handling</a></li><li class="chapter-item expanded "><a href="../features/camera.html"><strong aria-hidden="true">3.4.</strong> Cameras</a></li><li class="chapter-item expanded "><a href="../features/fixed-timestep.html"><strong aria-hidden="true">3.5.</strong> Fixed Timestep</a></li></ol></li><li class="chapter-item expanded "><a href="../pitfalls/_index.html"><strong aria-hidden="true">4.</strong> Common Pitfalls</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../pitfalls/into-system.html"><strong aria-hidden="true">4.1.</strong> Error adding function as system</a></li><li class="chapter-item expanded "><a href="../pitfalls/frame-delay.html"><strong aria-hidden="true">4.2.</strong> Frame Delays / 1-frame-lag</a></li><li class="chapter-item expanded "><a href="../pitfalls/ui-camera.html"><strong aria-hidden="true">4.3.</strong> UI is not displaying</a></li><li class="chapter-item expanded "><a href="../pitfalls/performance.html"><strong aria-hidden="true">4.4.</strong> Slow Performance</a></li><li class="chapter-item expanded "><a href="../pitfalls/file-formats.html"><strong aria-hidden="true">4.5.</strong> File Format Support</a></li><li class="chapter-item expanded "><a href="../pitfalls/time.html"><strong aria-hidden="true">4.6.</strong> Bevy Time vs. Rust/OS time</a></li><li class="chapter-item expanded "><a href="../pitfalls/ui-y-up.html"><strong aria-hidden="true">4.7.</strong> UI layout is inverted</a></li></ol></li><li class="chapter-item expanded "><a href="../patterns/_index.html"><strong aria-hidden="true">5.</strong> Advanced Patterns</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../patterns/generic-systems.html"><strong aria-hidden="true">5.1.</strong> Generic Systems</a></li></ol></li><li class="chapter-item expanded "><a href="../cookbook/_index.html"><strong aria-hidden="true">6.</strong> Bevy Cookbook</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../cookbook/quit.html"><strong aria-hidden="true">6.1.</strong> Quit the App</a></li><li class="chapter-item expanded "><a href="../cookbook/clear-color.html"><strong aria-hidden="true">6.2.</strong> Change the Background Color</a></li><li class="chapter-item expanded "><a href="../cookbook/print-framerate.html"><strong aria-hidden="true">6.3.</strong> Show Framerate in Console</a></li><li class="chapter-item expanded "><a href="../cookbook/mouse-grab.html"><strong aria-hidden="true">6.4.</strong> Grab the Mouse</a></li><li class="chapter-item expanded "><a href="../cookbook/assets-ready.html"><strong aria-hidden="true">6.5.</strong> Track Assets Loading</a></li><li class="chapter-item expanded "><a href="../cookbook/cursor2world.html"><strong aria-hidden="true">6.6.</strong> Convert cursor to world coordinates</a></li><li class="chapter-item expanded "><a href="../cookbook/custom-projection.html"><strong aria-hidden="true">6.7.</strong> Custom Camera Projection</a></li><li class="chapter-item expanded "><a href="../cookbook/pan-orbit-camera.html"><strong aria-hidden="true">6.8.</strong> Pan+Orbit Camera</a></li><li class="chapter-item expanded "><a href="../cookbook/print-resources.html"><strong aria-hidden="true">6.9.</strong> List All Resource Types</a></li></ol></li><li class="chapter-item expanded "><a href="../platforms/_index.html"><strong aria-hidden="true">7.</strong> Bevy on Different Platforms</a></li><li class="chapter-item expanded affix "><a href="../contributing.html">Contributing</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="system-order-of-execution"><a class="header" href="#system-order-of-execution">System Order of Execution</a></h1>
<p>Bevy's scheduling algorithm is designed to deliver maximum performance by
running as many systems as possible in parallel across the available CPU
threads.</p>
<p>This is possible when the systems do not conflict over the data they need
to access. However, when a system needs to have mutable (exclusive) access to a
piece of data, other systems that need to access the same data cannot be run at
the same time. Bevy determines all of this information from the system's
function signature (the types of the parameters it takes).</p>
<p>In such situations, the order is <em>nondeterministic</em> by default. Bevy takes no
regard for when each system will run, and the order could even change every frame!</p>
<h2 id="does-it-even-matter"><a class="header" href="#does-it-even-matter">Does it even matter?</a></h2>
<p>In many cases, you don't need to worry about this.</p>
<p>However, sometimes you need to rely on specific systems to run in a particular
order. For example:</p>
<ul>
<li>Maybe the logic you wrote in one of your systems needs any modifications
done to that data by another system to always happen first?</li>
<li>One system needs to receive <a href="./events.html">events</a> sent by another system.</li>
<li>You are using <a href="./change-detection.html">change detection</a>.</li>
</ul>
<p>In such situations, systems running in the wrong order typically causes their
behavior <a href="../pitfalls/frame-delay.html">to be delayed until the next frame</a>. In
rare cases, depending on your game logic, it may even result in more serious
logic bugs!</p>
<p>It is up to you to decide if this is important.</p>
<p>With many things in typical games, such as juicy visual effects, it probably
doesn't matter if they get delayed by a frame. It might not be worthwhile to
bother with it. If you don't care, leaving the order ambiguous may also result
in better performance.</p>
<p>On the other hand, for things like handling the player input controls, this
would result in annoying lag, so you should probably fix it.</p>
<h2 id="explicit-system-ordering"><a class="header" href="#explicit-system-ordering">Explicit System Ordering</a></h2>
<p>The solution is to use system <a href="./labels.html">labels</a> to explicitly specify the
order you want:</p>
<pre><code class="language-rust no_run noplayground">fn main() {
    App::build()
        .add_plugins(DefaultPlugins)

        // order doesn't matter for these systems:
        .add_system(particle_effects.system())
        .add_system(npc_behaviors.system())
        .add_system(enemy_movement.system())

        // create labels, because we need to order other systems around these:
        .add_system(map_player_input.system().label(&quot;input&quot;))
        .add_system(update_map.system().label(&quot;map&quot;))

        // this will always run before anything labeled &quot;input&quot;
        .add_system(input_parameters.system().before(&quot;input&quot;))

        // this will always run after anything labeled &quot;input&quot; and &quot;map&quot;
        // also label it just in case
        .add_system(
            player_movement.system()
                .label(&quot;player_movement&quot;)
                .after(&quot;input&quot;)
                .after(&quot;map&quot;)
        )
        .run();
}
</code></pre>
<p>Each label is a reference point that other systems can be ordered around.</p>
<p><code>.label</code>/<code>.before</code>/<code>.after</code> may be used as many times as you need on one system.</p>
<p>You can place multiple labels on one system.</p>
<p>You can also use the same label on multiple systems.</p>
<p>When you have multiple systems with common labels or ordering, it may be
convenient to use <a href="./system-sets.html">system sets</a>.</p>
<h2 id="circular-dependencies"><a class="header" href="#circular-dependencies">Circular Dependencies</a></h2>
<p>If you have multiple systems mutually depending on each other, then it is
clearly impossible to resolve the situation completely like that.</p>
<p>You should try to redesign your game to avoid such situations, or just accept
the consequences. You can at least make it behave predictably, using explicit
ordering to specify the order you prefer.</p>
<p>In really advanced scenarios, if you insist on all affected systems becoming
settled during the same frame, you might be able to do it using <a href="./run-criteria-loop.html">Looping Run
Criteria</a> or <a href="./states.html">states</a>.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../programming/plugins.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../programming/system-sets.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../programming/plugins.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../programming/system-sets.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
